package hu.szigyi.ettl.web.tool

import com.typesafe.scalalogging.StrictLogging
import hu.szigyi.ettl.web.service.{LogService, MetricsService}
import hu.szigyi.ettl.web.service.LogService.LogLine

import java.time.temporal.ChronoUnit._

object LogAnalyser extends App with StrictLogging {

  val service = new MetricsService(new LogService(null, null) {
    override def readLatestLog: Seq[LogLine] = stringToLogLines(log).reverse
  })

  def stringToLogLines(logs: String): Seq[LogLine] = {
    val logLinesS: Seq[String] = logs.split("\n").toSeq.map(_.trim).filter(_ != "")
    logger.info(s"logLinesS: ${logLinesS.size}")

    val logLines: Seq[LogLine] = logLinesS.flatMap(LogService.parseLogLine)
    logger.info(s"logLines: ${logLines.size}")
    logLines
  }

  def timesBetweenShots(lines: Seq[LogLine]): Seq[String] =
    lines.filter(_.message.contains("Taking photo")).sliding(2).toSeq.zipWithIndex.map {
      case (window, index) => {
        val prev          = window(0)
        val current       = window(1)
        val elapsedMillis = MILLIS.between(prev.time, current.time)
        val value         = s"$elapsedMillis millis \t between ${index + 1}-${index + 2}"
        logger.info(value)
        value
      }
    }

  val log =
    """
22:15:59.604:::I:::             Clock: SystemClock[Europe/London]
22:15:59.618:::I:::      Dummy Camera: true
22:15:59.619:::I:::  Images Base Path: /home/pi/dev/ettl/captured-images
22:15:59.620:::I:::     # of Captures: 10
22:15:59.620:::I:::      Set Settings: false
22:15:59.621:::I:::          Interval: 2 seconds
22:15:59.622:::I:::Raw File Extension: JPG
22:15:59.883:::I:::Connecting to camera...
22:15:59.896:::T:::Getting settings names:
22:15:59.901:::T:::List()
22:15:59.930:::I:::Schedule starts: 2021-03-25T22:15:59.930575Z
22:16:01.388:::T:::Preparing the First task: 2021-03-25T22:16:01.388646Z
22:16:01.393:::T:::First task starts: 2021-03-25T22:16:01.393886Z
22:16:01.422:::I:::[1/10] Taking photo...
22:16:01.433:::D:::[1/10] Capture took: 6ms | 6161128ns
22:16:02.887:::I:::[1/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0001.JPG
22:16:02.888:::D:::[1/10] First Schedule took: 1494ms | 1494515804ns
22:16:02.905:::T:::Waiting -975 milliseconds -> Next: 22:16:01.930575 - Now: 22:16:02.905004
22:16:02.907:::I:::[2/10] Taking photo...
22:16:02.908:::D:::[2/10] Capture took: 0ms | 25261ns
22:16:02.931:::I:::[2/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0002.JPG
22:16:02.932:::D:::[2/10] Schedule took: 30ms | 30714649ns
22:16:02.934:::T:::Waiting 996 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:02.934105
22:16:02.935:::T:::feeling sleepy...
22:16:03.037:::T:::Waiting 893 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.037131
22:16:03.038:::T:::feeling sleepy...
22:16:03.139:::T:::Waiting 791 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.139048
22:16:03.140:::T:::feeling sleepy...
22:16:03.240:::T:::Waiting 690 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.240709
22:16:03.241:::T:::feeling sleepy...
22:16:03.342:::T:::Waiting 588 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.342342
22:16:03.343:::T:::feeling sleepy...
22:16:03.444:::T:::Waiting 486 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.444179
22:16:03.445:::T:::feeling sleepy...
22:16:03.546:::T:::Waiting 384 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.546291
22:16:03.547:::T:::feeling sleepy...
22:16:03.648:::T:::Waiting 282 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.648100
22:16:03.649:::T:::feeling sleepy...
22:16:03.750:::T:::Waiting 181 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.749844
22:16:03.752:::T:::feeling sleepy...
22:16:03.854:::T:::Waiting 77 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.853918
22:16:03.855:::T:::feeling sleepy...
22:16:03.956:::T:::Waiting -25 milliseconds -> Next: 22:16:03.930575 - Now: 22:16:03.955799
22:16:03.971:::I:::[3/10] Taking photo...
22:16:03.972:::D:::[3/10] Capture took: 0ms | 20208ns
22:16:03.988:::I:::[3/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0003.JPG
22:16:03.989:::D:::[3/10] Schedule took: 1055ms | 1055366161ns
22:16:03.990:::T:::Waiting 1940 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:03.990308
22:16:03.991:::T:::feeling sleepy...
22:16:04.092:::T:::Waiting 1839 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.091971
22:16:04.093:::T:::feeling sleepy...
22:16:04.194:::T:::Waiting 1737 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.193835
22:16:04.194:::T:::feeling sleepy...
22:16:04.295:::T:::Waiting 1635 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.295186
22:16:04.296:::T:::feeling sleepy...
22:16:04.397:::T:::Waiting 1534 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.396868
22:16:04.397:::T:::feeling sleepy...
22:16:04.498:::T:::Waiting 1432 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.498196
22:16:04.500:::T:::feeling sleepy...
22:16:04.601:::T:::Waiting 1329 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.601542
22:16:04.603:::T:::feeling sleepy...
22:16:04.704:::T:::Waiting 1226 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.704350
22:16:04.706:::T:::feeling sleepy...
22:16:04.807:::T:::Waiting 1123 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.807181
22:16:04.809:::T:::feeling sleepy...
22:16:04.911:::T:::Waiting 1020 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:04.910671
22:16:04.922:::T:::feeling sleepy...
22:16:05.024:::T:::Waiting 907 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.023931
22:16:05.026:::T:::feeling sleepy...
22:16:05.127:::T:::Waiting 803 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.127373
22:16:05.129:::T:::feeling sleepy...
22:16:05.231:::T:::Waiting 700 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.230673
22:16:05.233:::T:::feeling sleepy...
22:16:05.335:::T:::Waiting 596 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.334918
22:16:05.336:::T:::feeling sleepy...
22:16:05.437:::T:::Waiting 494 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.436804
22:16:05.437:::T:::feeling sleepy...
22:16:05.538:::T:::Waiting 392 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.538186
22:16:05.539:::T:::feeling sleepy...
22:16:05.640:::T:::Waiting 291 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.639841
22:16:05.640:::T:::feeling sleepy...
22:16:05.741:::T:::Waiting 189 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.741300
22:16:05.742:::T:::feeling sleepy...
22:16:05.843:::T:::Waiting 88 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.842908
22:16:05.844:::T:::feeling sleepy...
22:16:05.945:::T:::Waiting -14 milliseconds -> Next: 22:16:05.930575 - Now: 22:16:05.944768
22:16:05.946:::I:::[4/10] Taking photo...
22:16:05.946:::D:::[4/10] Capture took: 0ms | 19479ns
22:16:05.960:::I:::[4/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0004.JPG
22:16:05.961:::D:::[4/10] Schedule took: 1970ms | 1970931640ns
22:16:05.962:::T:::Waiting 1969 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:05.961984
22:16:05.962:::T:::feeling sleepy...
22:16:06.063:::T:::Waiting 1867 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.063185
22:16:06.065:::T:::feeling sleepy...
22:16:06.167:::T:::Waiting 1764 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.166636
22:16:06.168:::T:::feeling sleepy...
22:16:06.271:::T:::Waiting 1660 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.270751
22:16:06.272:::T:::feeling sleepy...
22:16:06.372:::T:::Waiting 1558 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.372631
22:16:06.373:::T:::feeling sleepy...
22:16:06.474:::T:::Waiting 1456 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.474248
22:16:06.475:::T:::feeling sleepy...
22:16:06.576:::T:::Waiting 1355 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.575859
22:16:06.576:::T:::feeling sleepy...
22:16:06.677:::T:::Waiting 1253 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.677123
22:16:06.678:::T:::feeling sleepy...
22:16:06.779:::T:::Waiting 1152 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.778986
22:16:06.780:::T:::feeling sleepy...
22:16:06.881:::T:::Waiting 1049 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.881509
22:16:06.882:::T:::feeling sleepy...
22:16:06.984:::T:::Waiting 946 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:06.984174
22:16:06.986:::T:::feeling sleepy...
22:16:07.088:::T:::Waiting 843 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.087846
22:16:07.089:::T:::feeling sleepy...
22:16:07.190:::T:::Waiting 740 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.190226
22:16:07.191:::T:::feeling sleepy...
22:16:07.292:::T:::Waiting 638 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.292083
22:16:07.293:::T:::feeling sleepy...
22:16:07.394:::T:::Waiting 537 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.393827
22:16:07.394:::T:::feeling sleepy...
22:16:07.495:::T:::Waiting 435 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.495199
22:16:07.496:::T:::feeling sleepy...
22:16:07.597:::T:::Waiting 334 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.596824
22:16:07.598:::T:::feeling sleepy...
22:16:07.699:::T:::Waiting 232 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.698749
22:16:07.700:::T:::feeling sleepy...
22:16:07.801:::T:::Waiting 129 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.801241
22:16:07.803:::T:::feeling sleepy...
22:16:07.904:::T:::Waiting 26 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:07.904538
22:16:07.906:::T:::feeling sleepy...
22:16:08.008:::T:::Waiting -78 milliseconds -> Next: 22:16:07.930575 - Now: 22:16:08.008471
22:16:08.010:::I:::[5/10] Taking photo...
22:16:08.011:::D:::[5/10] Capture took: 0ms | 23229ns
22:16:08.031:::I:::[5/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0005.JPG
22:16:08.032:::D:::[5/10] Schedule took: 2070ms | 2070398274ns
22:16:08.033:::T:::Waiting 1897 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.033441
22:16:08.034:::T:::feeling sleepy...
22:16:08.135:::T:::Waiting 1795 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.135644
22:16:08.137:::T:::feeling sleepy...
22:16:08.238:::T:::Waiting 1692 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.238217
22:16:08.240:::T:::feeling sleepy...
22:16:08.341:::T:::Waiting 1589 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.341587
22:16:08.343:::T:::feeling sleepy...
22:16:08.445:::T:::Waiting 1486 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.444821
22:16:08.447:::T:::feeling sleepy...
22:16:08.548:::T:::Waiting 1382 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.548254
22:16:08.550:::T:::feeling sleepy...
22:16:08.651:::T:::Waiting 1279 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.651571
22:16:08.653:::T:::feeling sleepy...
22:16:08.755:::T:::Waiting 1176 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.754870
22:16:08.756:::T:::feeling sleepy...
22:16:08.858:::T:::Waiting 1072 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.858061
22:16:08.860:::T:::feeling sleepy...
22:16:08.962:::T:::Waiting 968 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:08.962029
22:16:08.963:::T:::feeling sleepy...
22:16:09.064:::T:::Waiting 867 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.063941
22:16:09.065:::T:::feeling sleepy...
22:16:09.166:::T:::Waiting 765 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.165853
22:16:09.166:::T:::feeling sleepy...
22:16:09.267:::T:::Waiting 663 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.267120
22:16:09.268:::T:::feeling sleepy...
22:16:09.369:::T:::Waiting 562 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.368896
22:16:09.369:::T:::feeling sleepy...
22:16:09.470:::T:::Waiting 460 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.470287
22:16:09.471:::T:::feeling sleepy...
22:16:09.572:::T:::Waiting 358 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.572236
22:16:09.573:::T:::feeling sleepy...
22:16:09.674:::T:::Waiting 256 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.674034
22:16:09.676:::T:::feeling sleepy...
22:16:09.777:::T:::Waiting 153 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.777603
22:16:09.779:::T:::feeling sleepy...
22:16:09.880:::T:::Waiting 50 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.880299
22:16:09.881:::T:::feeling sleepy...
22:16:09.983:::T:::Waiting -52 milliseconds -> Next: 22:16:09.930575 - Now: 22:16:09.982977
22:16:09.993:::I:::[6/10] Taking photo...
22:16:09.995:::D:::[6/10] Capture took: 0ms | 28854ns
22:16:10.021:::I:::[6/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0006.JPG
22:16:10.022:::D:::[6/10] Schedule took: 1989ms | 1989461533ns
22:16:10.024:::T:::Waiting 1906 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.024269
22:16:10.025:::T:::feeling sleepy...
22:16:10.127:::T:::Waiting 1804 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.126852
22:16:10.128:::T:::feeling sleepy...
22:16:10.229:::T:::Waiting 1701 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.229447
22:16:10.231:::T:::feeling sleepy...
22:16:10.332:::T:::Waiting 1598 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.332620
22:16:10.334:::T:::feeling sleepy...
22:16:10.436:::T:::Waiting 1495 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.435836
22:16:10.438:::T:::feeling sleepy...
22:16:10.539:::T:::Waiting 1391 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.539337
22:16:10.541:::T:::feeling sleepy...
22:16:10.642:::T:::Waiting 1288 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.642383
22:16:10.651:::T:::feeling sleepy...
22:16:10.754:::T:::Waiting 1176 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.754641
22:16:10.756:::T:::feeling sleepy...
22:16:10.857:::T:::Waiting 1073 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.857427
22:16:10.858:::T:::feeling sleepy...
22:16:10.959:::T:::Waiting 971 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:10.959714
22:16:10.961:::T:::feeling sleepy...
22:16:11.062:::T:::Waiting 869 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.061806
22:16:11.063:::T:::feeling sleepy...
22:16:11.164:::T:::Waiting 766 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.164184
22:16:11.165:::T:::feeling sleepy...
22:16:11.266:::T:::Waiting 664 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.266208
22:16:11.267:::T:::feeling sleepy...
22:16:11.368:::T:::Waiting 562 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.368384
22:16:11.369:::T:::feeling sleepy...
22:16:11.471:::T:::Waiting 459 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.471526
22:16:11.473:::T:::feeling sleepy...
22:16:11.576:::T:::Waiting 354 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.576130
22:16:11.578:::T:::feeling sleepy...
22:16:11.679:::T:::Waiting 251 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.679255
22:16:11.680:::T:::feeling sleepy...
22:16:11.781:::T:::Waiting 149 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.781095
22:16:11.782:::T:::feeling sleepy...
22:16:11.883:::T:::Waiting 47 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.883498
22:16:11.884:::T:::feeling sleepy...
22:16:11.985:::T:::Waiting -55 milliseconds -> Next: 22:16:11.930575 - Now: 22:16:11.985363
22:16:11.987:::I:::[7/10] Taking photo...
22:16:11.988:::D:::[7/10] Capture took: 0ms | 18750ns
22:16:12.001:::I:::[7/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0007.JPG
22:16:12.002:::D:::[7/10] Schedule took: 1978ms | 1978524795ns
22:16:12.003:::T:::Waiting 1927 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.003724
22:16:12.004:::T:::feeling sleepy...
22:16:12.105:::T:::Waiting 1825 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.105559
22:16:12.107:::T:::feeling sleepy...
22:16:12.208:::T:::Waiting 1723 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.207966
22:16:12.209:::T:::feeling sleepy...
22:16:12.310:::T:::Waiting 1620 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.310454
22:16:12.311:::T:::feeling sleepy...
22:16:12.413:::T:::Waiting 1517 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.413594
22:16:12.416:::T:::feeling sleepy...
22:16:12.518:::T:::Waiting 1413 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.517931
22:16:12.519:::T:::feeling sleepy...
22:16:12.621:::T:::Waiting 1309 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.621247
22:16:12.622:::T:::feeling sleepy...
22:16:12.723:::T:::Waiting 1207 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.723534
22:16:12.724:::T:::feeling sleepy...
22:16:12.825:::T:::Waiting 1105 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.825551
22:16:12.826:::T:::feeling sleepy...
22:16:12.927:::T:::Waiting 1003 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:12.927562
22:16:12.928:::T:::feeling sleepy...
22:16:13.029:::T:::Waiting 901 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.029693
22:16:13.031:::T:::feeling sleepy...
22:16:13.132:::T:::Waiting 799 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.131791
22:16:13.133:::T:::feeling sleepy...
22:16:13.235:::T:::Waiting 696 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.234802
22:16:13.237:::T:::feeling sleepy...
22:16:13.338:::T:::Waiting 592 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.338562
22:16:13.341:::T:::feeling sleepy...
22:16:13.443:::T:::Waiting 487 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.443012
22:16:13.444:::T:::feeling sleepy...
22:16:13.545:::T:::Waiting 385 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.545309
22:16:13.546:::T:::feeling sleepy...
22:16:13.648:::T:::Waiting 283 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.647966
22:16:13.649:::T:::feeling sleepy...
22:16:13.750:::T:::Waiting 180 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.750273
22:16:13.751:::T:::feeling sleepy...
22:16:13.852:::T:::Waiting 78 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.852286
22:16:13.853:::T:::feeling sleepy...
22:16:13.954:::T:::Waiting -24 milliseconds -> Next: 22:16:13.930575 - Now: 22:16:13.954325
22:16:13.955:::I:::[8/10] Taking photo...
22:16:13.956:::D:::[8/10] Capture took: 0ms | 18281ns
22:16:13.980:::I:::[8/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0008.JPG
22:16:13.981:::D:::[8/10] Schedule took: 1977ms | 1977838547ns
22:16:13.982:::T:::Waiting 1948 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:13.982594
22:16:13.983:::T:::feeling sleepy...
22:16:14.084:::T:::Waiting 1846 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.084460
22:16:14.085:::T:::feeling sleepy...
22:16:14.187:::T:::Waiting 1744 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.186767
22:16:14.189:::T:::feeling sleepy...
22:16:14.291:::T:::Waiting 1640 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.290815
22:16:14.292:::T:::feeling sleepy...
22:16:14.393:::T:::Waiting 1537 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.393051
22:16:14.394:::T:::feeling sleepy...
22:16:14.495:::T:::Waiting 1436 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.494808
22:16:14.496:::T:::feeling sleepy...
22:16:14.597:::T:::Waiting 1333 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.597436
22:16:14.598:::T:::feeling sleepy...
22:16:14.699:::T:::Waiting 1231 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.699648
22:16:14.700:::T:::feeling sleepy...
22:16:14.801:::T:::Waiting 1129 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.801675
22:16:14.802:::T:::feeling sleepy...
22:16:14.903:::T:::Waiting 1027 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:14.903297
22:16:14.904:::T:::feeling sleepy...
22:16:15.005:::T:::Waiting 926 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.004890
22:16:15.007:::T:::feeling sleepy...
22:16:15.118:::T:::Waiting 813 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.117893
22:16:15.120:::T:::feeling sleepy...
22:16:15.222:::T:::Waiting 708 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.222135
22:16:15.223:::T:::feeling sleepy...
22:16:15.324:::T:::Waiting 606 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.324031
22:16:15.325:::T:::feeling sleepy...
22:16:15.426:::T:::Waiting 505 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.425823
22:16:15.427:::T:::feeling sleepy...
22:16:15.531:::T:::Waiting 399 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.531267
22:16:15.532:::T:::feeling sleepy...
22:16:15.633:::T:::Waiting 297 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.633126
22:16:15.634:::T:::feeling sleepy...
22:16:15.736:::T:::Waiting 194 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.736290
22:16:15.737:::T:::feeling sleepy...
22:16:15.838:::T:::Waiting 92 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.838327
22:16:15.839:::T:::feeling sleepy...
22:16:15.940:::T:::Waiting -10 milliseconds -> Next: 22:16:15.930575 - Now: 22:16:15.940478
22:16:15.942:::I:::[9/10] Taking photo...
22:16:15.944:::D:::[9/10] Capture took: 0ms | 28594ns
22:16:15.970:::I:::[9/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0009.JPG
22:16:15.972:::D:::[9/10] Schedule took: 1989ms | 1989462627ns
22:16:15.980:::T:::Waiting 1950 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:15.980100
22:16:15.982:::T:::feeling sleepy...
22:16:16.084:::T:::Waiting 1847 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.083816
22:16:16.085:::T:::feeling sleepy...
22:16:16.186:::T:::Waiting 1744 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.186258
22:16:16.187:::T:::feeling sleepy...
22:16:16.288:::T:::Waiting 1642 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.288137
22:16:16.289:::T:::feeling sleepy...
22:16:16.390:::T:::Waiting 1541 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.389858
22:16:16.391:::T:::feeling sleepy...
22:16:16.492:::T:::Waiting 1438 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.492012
22:16:16.493:::T:::feeling sleepy...
22:16:16.595:::T:::Waiting 1336 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.594877
22:16:16.596:::T:::feeling sleepy...
22:16:16.697:::T:::Waiting 1233 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.697248
22:16:16.698:::T:::feeling sleepy...
22:16:16.799:::T:::Waiting 1131 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.799458
22:16:16.810:::T:::feeling sleepy...
22:16:16.912:::T:::Waiting 1019 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:16.911820
22:16:16.914:::T:::feeling sleepy...
22:16:17.015:::T:::Waiting 915 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.015435
22:16:17.017:::T:::feeling sleepy...
22:16:17.118:::T:::Waiting 813 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.117803
22:16:17.119:::T:::feeling sleepy...
22:16:17.220:::T:::Waiting 710 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.220024
22:16:17.221:::T:::feeling sleepy...
22:16:17.322:::T:::Waiting 608 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.322502
22:16:17.323:::T:::feeling sleepy...
22:16:17.424:::T:::Waiting 506 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.424696
22:16:17.426:::T:::feeling sleepy...
22:16:17.527:::T:::Waiting 403 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.527162
22:16:17.528:::T:::feeling sleepy...
22:16:17.630:::T:::Waiting 301 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.629719
22:16:17.631:::T:::feeling sleepy...
22:16:17.732:::T:::Waiting 199 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.731985
22:16:17.733:::T:::feeling sleepy...
22:16:17.834:::T:::Waiting 96 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.834270
22:16:17.835:::T:::feeling sleepy...
22:16:17.936:::T:::Waiting -6 milliseconds -> Next: 22:16:17.930575 - Now: 22:16:17.936212
22:16:17.937:::I:::[10/10] Taking photo...
22:16:17.937:::D:::[10/10] Capture took: 0ms | 18490ns
22:16:17.950:::I:::[10/10] Saved image: /home/pi/dev/ettl/captured-images/2021_03_25_22_15_59/IMG_0010.JPG
22:16:17.951:::D:::[10/10] Schedule took: 1971ms | 1971536534ns
22:16:18.093:::I:::App finished
      """

  private val logLines = stringToLogLines(log)
  timesBetweenShots(logLines)
  logger.info("Time Residuals")
  service.getLatestTimeResiduals.map(r => logger.info(s"${r.orderNumber}\t${r.difference}\t${r.expected}-${r.actual}"))
}
